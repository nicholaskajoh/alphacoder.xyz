<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Build a Facebook clone from scratch with PHP — Part 6 | Alpha Coder</title>

    <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
    
    <style>body{margin:40px auto;max-width:650px;line-height:1.6;font-family:merriweather,serif;font-size:16px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}div.header h1{padding-top:0;padding-bottom:8px;margin-bottom:24px;font-size:15px;font-weight:400;border-bottom:1px solid}.header-menu{float:right}.header-menu a{padding-left:5px}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 8px;display:inline-block}div.footer{border-top:1px solid;text-align:center}.footer-links a{padding:0 5px}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}a,a:visited,a:hover,a:active{color:#00e}.posts-list li:not(:last-child){padding-bottom:20px}.post-meta a:not(:last-child){padding-right:5px}blockquote{margin-top:10px;margin-bottom:10px;margin-left:50px;padding-left:15px;border-left:3px solid #ccc;background-color:#f9f9f9;font-style:italic}</style>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-82728104-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    

    

    <meta property="og:title" content="Build a Facebook clone from scratch with PHP — Part 6" />
<meta property="og:description" content="All parts  Build a Facebook clone from scratch with PHP — Part 1 Build a Facebook clone from scratch with PHP — Part 2 Build a Facebook clone from scratch with PHP — Part 3 Build a Facebook clone from scratch with PHP — Part 4 Build a Facebook clone from scratch with PHP — Part 5 Build a Facebook clone from scratch with PHP — Part 6 (this article) Build a Facebook clone from scratch with PHP — Part 7  Relationships are the point of social networks." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://alphacoder.xyz/facebook-clone-6/" />
<meta property="article:published_time" content="2017-09-23T09:07:23+01:00" />
<meta property="article:modified_time" content="2017-09-23T09:07:23+01:00" />

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Build a Facebook clone from scratch with PHP — Part 6"/>
<meta name="twitter:description" content="All parts  Build a Facebook clone from scratch with PHP — Part 1 Build a Facebook clone from scratch with PHP — Part 2 Build a Facebook clone from scratch with PHP — Part 3 Build a Facebook clone from scratch with PHP — Part 4 Build a Facebook clone from scratch with PHP — Part 5 Build a Facebook clone from scratch with PHP — Part 6 (this article) Build a Facebook clone from scratch with PHP — Part 7  Relationships are the point of social networks."/>

    <meta itemprop="name" content="Build a Facebook clone from scratch with PHP — Part 6">
<meta itemprop="description" content="All parts  Build a Facebook clone from scratch with PHP — Part 1 Build a Facebook clone from scratch with PHP — Part 2 Build a Facebook clone from scratch with PHP — Part 3 Build a Facebook clone from scratch with PHP — Part 4 Build a Facebook clone from scratch with PHP — Part 5 Build a Facebook clone from scratch with PHP — Part 6 (this article) Build a Facebook clone from scratch with PHP — Part 7  Relationships are the point of social networks.">
<meta itemprop="datePublished" content="2017-09-23T09:07:23&#43;01:00" />
<meta itemprop="dateModified" content="2017-09-23T09:07:23&#43;01:00" />
<meta itemprop="wordCount" content="1384">



<meta itemprop="keywords" content="Facebook Clone Series," />
</head>


<body>
<div class="header">
    <h1>
        <a href="/">Alpha Coder</a>
        <div class="header-menu">
            <a href="/blog/">Blog</a>
            <a href="/support/">Support</a>
            <a href="/courses/">Courses</a>
        </div>
    </h1>
</div>
<div id="content">

<header>
    <h1>Build a Facebook clone from scratch with PHP — Part 6</h1>
    

<div class="post-meta">
    <time datetime="2017-09-23">Sep 23, 2017</time>
    | Tags:
    <a href="http://alphacoder.xyz/tag/facebook-clone-series/">Facebook Clone Series</a>
</div>
</header>
<article>
    <h1 id="all-parts">All parts</h1>
<ul>
<li><a href="/facebook-clone-1">Build a Facebook clone from scratch with PHP — Part 1</a></li>
<li><a href="/facebook-clone-2">Build a Facebook clone from scratch with PHP — Part 2</a></li>
<li><a href="/facebook-clone-3">Build a Facebook clone from scratch with PHP — Part 3</a></li>
<li><a href="/facebook-clone-4">Build a Facebook clone from scratch with PHP — Part 4</a></li>
<li><a href="/facebook-clone-5">Build a Facebook clone from scratch with PHP — Part 5</a></li>
<li>Build a Facebook clone from scratch with PHP — Part 6 (this article)</li>
<li><a href="/facebook-clone-7">Build a Facebook clone from scratch with PHP — Part 7</a></li>
</ul>
<p>Relationships are the point of social networks. For real! Social networks like Facebook enable us connect with different people far and near and to share in their life and experiences. Facebook uses the &ldquo;friend&rdquo; model of relationships (I'm your friend; you're my friend). There are other models like the popular &ldquo;following-follower&rdquo; model. Implementing relationships can easily get complex. We want to keep things simple though so we'll explore a very basic approach. Also, we won't be exploiting the relationship model we'll be creating in the workings of our application. Again, it's to keep things simple.</p>
<h1 id="friend-relationships">Friend relationships</h1>
<p><em>I'm your friend and you're my friend</em>. That's the idea for the friend relationship model. It starts by making a friend request. The user at the receiving end may choose to accept or decline the request. If they accept, the user who made the request is added to their friends&rsquo; list and vice versa [or so] thus a relationship exists between the two of them. If a request is declined, nothing happens, basically.</p>
<p>Without further ado, let's implement something of that sort for FaceClone.</p>
<h1 id="list-users">List users</h1>
<p>We want to provide a list of FaceClone users to a user so that they can add any of them as friends. The right sidebar of the home.php template has an &ldquo;add friend&rdquo; panel. Let's use it. All we need do is list out all our users.</p>
<p>In the &ldquo;add friend&rdquo; section, we'll have…</p>
<pre><code>&lt;h4&gt;add friend&lt;/h4&gt;
&lt;?php
    $sql = &quot;SELECT id, username, (SELECT COUNT(*) FROM friends WHERE friends.user_id = users.id AND friends.friend_id = {$_SESSION['user_id']}) AS is_friend FROM users WHERE id != {$_SESSION['user_id']} HAVING is_friend = 0&quot;;
    $result = $conn-&gt;query($sql);

    if ($result-&gt;num_rows &gt; 0) {
        ?&gt;&lt;ul&gt;&lt;?php
    
        while($fc_user = $result-&gt;fetch_assoc()) {
            ?&gt;&lt;li&gt;
                &lt;a href=&quot;profile.php?username=&lt;?php echo $fc_user['username']; ?&gt;&quot;&gt;
                    &lt;?php echo $fc_user['username']; ?&gt;
                &lt;/a&gt; 
                &lt;a href=&quot;php/add-friend.php?uid=&lt;?php echo $fc_user['id']; ?&gt;&quot;&gt;[add]&lt;/a&gt;
            &lt;/li&gt;&lt;?php
        }
    
        ?&gt;&lt;/ul&gt;&lt;?php
    } else {
        ?&gt;&lt;p class=&quot;text-center&quot;&gt;No users to add!&lt;/p&gt;&lt;?php
    }
?&gt;
</code></pre>
<p>Now that's some code! Let's break it down bit by bit. We want to list FaceClone users. That's the goal. So why do we have a long and &ldquo;complex&rdquo; SQL query? Can't we just use <code>SELECT * FROM users</code>? We can. But it's not that simple. There are 2 constraints we need to set. First, users that are already friends with the current user (who is looking to get new friends) shouldn't be displayed on the list. That makes sense right? Secondly, the current user shouldn't be on the list. You shouldn't be able to friend yourself, should you? There are other constraints that can be added to make things more fluid as well as &ldquo;waterproof&rdquo;, but considering them would just make things more complicated so we'll just leave things as they are.</p>
<p>To achieve the first constraint, we added a column to the users table results called <code>is_friend</code>.</p>
<pre><code>(SELECT COUNT(*) FROM friends WHERE friends.user_id = users.id AND friends.friend_id = {$_SESSION['user_id']}) AS is_friend
</code></pre>
<p>This column would contain a 0 or 1 for each user record. 0 means not a friend of the current user while 1 means [already] a friend. Using the <code>HAVING</code> keyword, we exclude records with <code>is_friend</code> value of 1. That is&hellip;</p>
<pre><code>HAVING is_friend = 0
</code></pre>
<p>The second constraint is achieved using the <code>WHERE</code> clause to exclude the current user from the list thus:</p>
<pre><code>WHERE id != {$_SESSION['user_id']}
</code></pre>
<h1 id="send-a-friendrequest">Send a friend request</h1>
<p>In the users list, there's an add friend link beside each username.</p>
<pre><code>&lt;a href=&quot;php/add-friend.php?uid=&lt;?php echo $fc_user['id']; ?&gt;&quot;&gt;[add]&lt;/a&gt;
</code></pre>
<p>The links lead to a GET endpoint <code>php/add-friend.php?uid=</code>. Go ahead, as always and create a file in the php folder called add-friend.php with the following code&hellip;</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;INSERT INTO friend_requests (user_id, friend_id) VALUES (?, ?)&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('ii', $_SESSION['user_id'], $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/home.php?request_sent=true&quot;);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>With a supplied user id in the GET request, we can create a new friend request. The user to whom the request is being made is the friend so their id is stored in <code>friend_id</code>.</p>
<h1 id="acceptdecline-friendrequests">Accept/decline friend requests</h1>
<p>The user who is requested should be able to see who requested them and choose whether to accept or decline. The left sidebar in home.php provides such a facility. With a little padding, we could arrive at something like this:</p>
<pre><code>&lt;h4&gt;friend requests&lt;/h4&gt;
&lt;?php
    $sql = &quot;SELECT * FROM friend_requests WHERE friend_id = {$_SESSION['user_id']}&quot;;
    $result = $conn-&gt;query($sql);

    if ($result-&gt;num_rows &gt; 0) {
        ?&gt;&lt;ul&gt;&lt;?php

        while($f_request = $result-&gt;fetch_assoc()) {
            ?&gt;&lt;li&gt;&lt;?php
                
            $u_sql = &quot;SELECT * FROM users WHERE id = {$f_request['user_id']} LIMIT 1&quot;;
            $u_result = $conn-&gt;query($u_sql);
            $fr_user = $u_result-&gt;fetch_assoc();
            
            ?&gt;&lt;a href=&quot;profile.php?username=&lt;?php echo $fr_user['username']; ?&gt;&quot;&gt;
                &lt;?php echo $fr_user['username']; ?&gt;
            &lt;/a&gt; 
                
            &lt;a class=&quot;text-success&quot; href=&quot;php/accept-request.php?uid=&lt;?php echo $fr_user['id']; ?&gt;&quot;&gt;
                [accept]
            &lt;/a&gt; 
                
            &lt;a class=&quot;text-danger&quot; href=&quot;php/remove-request.php?uid=&lt;?php echo $fr_user['id']; ?&gt;&quot;&gt;
                [decline]
            &lt;/a&gt;

            &lt;/li&gt;&lt;?php
        }

        ?&gt;&lt;/ul&gt;&lt;?php
    } else {
        ?&gt;&lt;p class=&quot;text-center&quot;&gt;No friend requests!&lt;/p&gt;&lt;?php
    }
?&gt;
</code></pre>
<p>In the snippet above, there are two sets of queries. The first pulls out all the friend requests to the current user. The second fetches data (of the requesting user) for each friend request.</p>
<p>There are two links beside each user's username. One to accept and the other to decline. They both lead to different end points. The former to <code>php/accept-request.php?uid=</code> and the latter to <code>php/remove-request.php?uid=</code>.</p>
<p>Remove request:</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;DELETE FROM friend_requests WHERE user_id = ?&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('i', $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/profile.php?username=&quot; . $_SESSION['user_username']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Accept request:</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    // add users to friends table
    $statement = $conn-&gt;prepare(&quot;INSERT INTO friends (user_id, friend_id) VALUES (?, ?), (?, ?)&quot;);
    $statement-&gt;bind_param('iiii', $_SESSION['user_id'], $_GET['uid'], $_GET['uid'], $_SESSION['user_id']);
    // remove friend request
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/php/remove-request.php?uid=&quot; . $_GET['uid']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Friendship is two-sided. I am your and you are my friend. As such, in accept-request.php we insert two records. In one, the current user is the friend and in the other the requesting user is the friend. While it seems like unnecessary duplication, it proves easier to manage. Also notice we use remove-request.php in accept-request.php to delete a friend request once two users have been added as friends.</p>
<h1 id="unfriend-user">Unfriend user</h1>
<p>Unfriending is as simple as removing the records in the friends table that connects two users.</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;DELETE FROM friends WHERE (user_id = ? AND friend_id = ?) OR (user_id = ? AND friend_id = ?)&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('iiii', $_GET['uid'], $_SESSION['user_id'], $_SESSION['user_id'], $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/profile.php?username=&quot; . $_SESSION['user_username']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Viola! We've built friend relationships into FaceClone!</p>
<p>Again, we're not exploiting the relationships we just created, to keep things simple. But it's pretty straightforward to do so. For example, instead of displaying all FaceClone posts on a user's feed, we could display only posts from their friends. We could also make some of a user's profile information only available to their friends. If we had a chat feature, we could allow only friends chat with each other. As a social network grows, this would make more sense. So if you're working on your social network app after this series (I totally encourage it), keep in mind what the relationships you create would imply.</p>
<p><em>At this point, I must say we are done; at least at the most basic level. So congrats for following through!!! Building a social networking app, especially one like Facebook, is a never-ending journey. There's always something to add to make it easier, faster and/or better to use.</em></p>
<p>We'll be deploying the FaceClone web app online for anyone to use in the next and last part of this series. Be sure to read it!</p>
<p><strong>The final code for this part is contained in my <a href="https://github.com/nicholaskajoh/faceclone">FaceClone repo</a>. Visit the link and click on the part-6 folder to see progress made so far.</strong></p>
<p>Next: <a href="/facebook-clone-7">Build a Facebook clone from scratch with PHP — Part 7</a>.</p>
<p>Previous: <a href="/facebook-clone-5">Build a Facebook clone from scratch with PHP — Part 5</a>.</p>

</article>



<p style="font-style: italic;">Need help getting something to work in your project? Try <a href="/support/">Alpha Coder Support</a>!</p>


<form
  style="border: 1px solid #ccc; padding: 3px; text-align: center; border-radius: 2px; margin: 15px 0;"
  action="https://tinyletter.com/nicholaskajoh"
  method="post"
  target="popupwindow" onsubmit="window.open('https://tinyletter.com/nicholaskajoh', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <div style="padding: 5px;">
      <h2>Subscribe to the Alpha Coder Newsletter!</h2>

      <p>Get timely updates on new articles, courses and more from Nicholas Kajoh. Unsubscribe anytime.</p>
      
      <input
        type="text"
        style="width: 150px; height: 30px; padding-left: 5px; border: 1px solid #ccc; border-radius: 2px;"
        name="email"
        placeholder="night.king@westeros.org">
      <input type="hidden" value="1" name="embed">
      <input
        type="submit"
        style="height: 34px; color: #fff; background-color: #00e; border: 1px solid #00e; border-radius: 2px;"
        value="Subscribe">
      
      <p>
        Enjoy the content on Alpha Coder? Please <a href="http://buymeacoff.ee/nicholaskajoh" target="_blank">buy me a coffee</a>. 😊
      </p>
    </div>
</form>




  
  
    <p>
      Previous post: <a href="http://alphacoder.xyz/facebook-clone-5/"><strong>Build a Facebook clone from scratch with PHP — Part 5</strong></a>
    </p>
  

  
    <p>
      Next post: <a href="http://alphacoder.xyz/responsive-grid-system/"><strong>A responsive grid system with few lines of CSS</strong></a>
    </p>
  
  



  <br><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "alphacoderxyz" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </div>
<div class="footer">
    
    
    <div class="footer-links">
        <a href="http://twitter.com/nicholaskajoh">Twitter</a>
        <a href="https://github.com/nicholaskajoh">GitHub</a>
        <a href="http://buymeacoff.ee/nicholaskajoh">Buy me a coffee</a>
        <a href="/blog/index.xml">RSS</a>
    </div>
    

    
    
    <div class="copyright">© Nicholas Kajoh</div>
    
</div>


<script src="https://unpkg.com/medium-zoom@1.0.4/dist/medium-zoom.min.js"></script>
<script>
  mediumZoom(document.querySelectorAll('img'));
</script></body>

</html>