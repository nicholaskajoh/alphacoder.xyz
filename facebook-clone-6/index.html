<!DOCTYPE html>
<html><head>
<title>Build a Facebook clone from scratch with PHP — Part 6</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">












<script defer data-domain="alphacoder.xyz" src="https://analytics.terna.io/js/plausible.js"></script>


<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://alphacoder.xyz/images/alpha-coder-logo-v1-small.png">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/journal.min.e3bbe8a4e9def42361d46a08558b2ceeb666c944d881cbcfa75a3435be6afa74.css" integrity="sha256-47vopOne9CNh1GoIVYss7rZmyUTYgcvPp1o0Nb5q&#43;nQ=" media="screen">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/dark-mode.min.16749f4d04ce998e04ecf1c45f01d051b413e9693378f8834e15973538e1d735.css" integrity="sha256-FnSfTQTOmY4E7PHEXwHQUbQT6WkzePiDThWXNTjh1zU=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons|Exo+2");
</script>






  <script src="/js/toc.js"></script>







<script src="https://cdn.jsdelivr.net/npm/vue-disqus@3/dist/vue-disqus.js"></script>








</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://alphacoder.xyz/">
    
        <div class="nav-title">
            Alpha Coder
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/blog/">
                Blog
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/guest-posts/">
                Guest Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tag/side-projects/">
                Side Projects
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://www.youtube.com/@alphacoderblog">
                Videos
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags/">
                Tags
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://twitter.com/AlphaCoderXYZ">
    Twitter
</a>
<br>

<a href="mailto:support@alphacoder.xyz">
    Email
</a>
<br>

<a href="/blog/index.xml">
    RSS
</a>
<br>


        &copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#all-parts" onclick="onNavClick(`#all-parts-nav`)" id="all-parts-nav">
									All parts
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#friend-relationships" onclick="onNavClick(`#friend-relationships-nav`)" id="friend-relationships-nav">
									Friend relationships
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#list-users" onclick="onNavClick(`#list-users-nav`)" id="list-users-nav">
									List users
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#send-a-friendrequest" onclick="onNavClick(`#send-a-friendrequest-nav`)" id="send-a-friendrequest-nav">
									Send a friend request
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#acceptdecline-friendrequests" onclick="onNavClick(`#acceptdecline-friendrequests-nav`)" id="acceptdecline-friendrequests-nav">
									Accept/decline friend requests
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#unfriend-user" onclick="onNavClick(`#unfriend-user-nav`)" id="unfriend-user-nav">
									Unfriend user
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/blog/">
                    Blog
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/guest-posts/">
                    Guest Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tag/side-projects/">
                    Side Projects
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://www.youtube.com/@alphacoderblog">
                    Videos
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags/">
                    Tags
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#all-parts" onclick="onNavClick(`#all-parts-nav`)" id="all-parts-nav">
									All parts
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#friend-relationships" onclick="onNavClick(`#friend-relationships-nav`)" id="friend-relationships-nav">
									Friend relationships
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#list-users" onclick="onNavClick(`#list-users-nav`)" id="list-users-nav">
									List users
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#send-a-friendrequest" onclick="onNavClick(`#send-a-friendrequest-nav`)" id="send-a-friendrequest-nav">
									Send a friend request
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#acceptdecline-friendrequests" onclick="onNavClick(`#acceptdecline-friendrequests-nav`)" id="acceptdecline-friendrequests-nav">
									Accept/decline friend requests
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#unfriend-user" onclick="onNavClick(`#unfriend-user-nav`)" id="unfriend-user-nav">
									Unfriend user
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://alphacoder.xyz/">
            Alpha Coder
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://alphacoder.xyz/">
        <div class="single-column-header-title">Alpha Coder</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title" v-pre>
                    Build a Facebook clone from scratch with PHP — Part 6
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2017-09-23
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tag/facebook-clone-series">Facebook Clone Series</a>
                                &nbsp;
                            
                                <a href="/tag/web-development">Web Development</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="all-parts">All parts</h1>
<ul>
<li><a href="/facebook-clone-1">Build a Facebook clone from scratch with PHP — Part 1</a></li>
<li><a href="/facebook-clone-2">Build a Facebook clone from scratch with PHP — Part 2</a></li>
<li><a href="/facebook-clone-3">Build a Facebook clone from scratch with PHP — Part 3</a></li>
<li><a href="/facebook-clone-4">Build a Facebook clone from scratch with PHP — Part 4</a></li>
<li><a href="/facebook-clone-5">Build a Facebook clone from scratch with PHP — Part 5</a></li>
<li>Build a Facebook clone from scratch with PHP — Part 6 (this article)</li>
<li><a href="/facebook-clone-7">Build a Facebook clone from scratch with PHP — Part 7</a></li>
</ul>
<p>Relationships are the point of social networks. For real! Social networks like Facebook enable us connect with different people far and near and to share in their life and experiences. Facebook uses the &ldquo;friend&rdquo; model of relationships (I&rsquo;m your friend; you&rsquo;re my friend). There are other models like the popular &ldquo;following-follower&rdquo; model. Implementing relationships can easily get complex. We want to keep things simple though so we&rsquo;ll explore a very basic approach. Also, we won&rsquo;t be exploiting the relationship model we&rsquo;ll be creating in the workings of our application. Again, it&rsquo;s to keep things simple.</p>
<h1 id="friend-relationships">Friend relationships</h1>
<p><em>I&rsquo;m your friend and you&rsquo;re my friend</em>. That&rsquo;s the idea for the friend relationship model. It starts by making a friend request. The user at the receiving end may choose to accept or decline the request. If they accept, the user who made the request is added to their friends&rsquo; list and vice versa [or so] thus a relationship exists between the two of them. If a request is declined, nothing happens, basically.</p>
<p>Without further ado, let&rsquo;s implement something of that sort for FaceClone.</p>
<h1 id="list-users">List users</h1>
<p>We want to provide a list of FaceClone users to a user so that they can add any of them as friends. The right sidebar of the home.php template has an &ldquo;add friend&rdquo; panel. Let&rsquo;s use it. All we need do is list out all our users.</p>
<p>In the &ldquo;add friend&rdquo; section, we&rsquo;ll have…</p>
<pre><code>&lt;h4&gt;add friend&lt;/h4&gt;
&lt;?php
    $sql = &quot;SELECT id, username, (SELECT COUNT(*) FROM friends WHERE friends.user_id = users.id AND friends.friend_id = {$_SESSION['user_id']}) AS is_friend FROM users WHERE id != {$_SESSION['user_id']} HAVING is_friend = 0&quot;;
    $result = $conn-&gt;query($sql);

    if ($result-&gt;num_rows &gt; 0) {
        ?&gt;&lt;ul&gt;&lt;?php
    
        while($fc_user = $result-&gt;fetch_assoc()) {
            ?&gt;&lt;li&gt;
                &lt;a href=&quot;profile.php?username=&lt;?php echo $fc_user['username']; ?&gt;&quot;&gt;
                    &lt;?php echo $fc_user['username']; ?&gt;
                &lt;/a&gt; 
                &lt;a href=&quot;php/add-friend.php?uid=&lt;?php echo $fc_user['id']; ?&gt;&quot;&gt;[add]&lt;/a&gt;
            &lt;/li&gt;&lt;?php
        }
    
        ?&gt;&lt;/ul&gt;&lt;?php
    } else {
        ?&gt;&lt;p class=&quot;text-center&quot;&gt;No users to add!&lt;/p&gt;&lt;?php
    }
?&gt;
</code></pre>
<p>Now that&rsquo;s some code! Let&rsquo;s break it down bit by bit. We want to list FaceClone users. That&rsquo;s the goal. So why do we have a long and &ldquo;complex&rdquo; SQL query? Can&rsquo;t we just use <code>SELECT * FROM users</code>? We can. But it&rsquo;s not that simple. There are 2 constraints we need to set. First, users that are already friends with the current user (who is looking to get new friends) shouldn&rsquo;t be displayed on the list. That makes sense right? Secondly, the current user shouldn&rsquo;t be on the list. You shouldn&rsquo;t be able to friend yourself, should you? There are other constraints that can be added to make things more fluid as well as &ldquo;waterproof&rdquo;, but considering them would just make things more complicated so we&rsquo;ll just leave things as they are.</p>
<p>To achieve the first constraint, we added a column to the users table results called <code>is_friend</code>.</p>
<pre><code>(SELECT COUNT(*) FROM friends WHERE friends.user_id = users.id AND friends.friend_id = {$_SESSION['user_id']}) AS is_friend
</code></pre>
<p>This column would contain a 0 or 1 for each user record. 0 means not a friend of the current user while 1 means [already] a friend. Using the <code>HAVING</code> keyword, we exclude records with <code>is_friend</code> value of 1. That is&hellip;</p>
<pre><code>HAVING is_friend = 0
</code></pre>
<p>The second constraint is achieved using the <code>WHERE</code> clause to exclude the current user from the list thus:</p>
<pre><code>WHERE id != {$_SESSION['user_id']}
</code></pre>
<h1 id="send-a-friendrequest">Send a friend request</h1>
<p>In the users list, there&rsquo;s an add friend link beside each username.</p>
<pre><code>&lt;a href=&quot;php/add-friend.php?uid=&lt;?php echo $fc_user['id']; ?&gt;&quot;&gt;[add]&lt;/a&gt;
</code></pre>
<p>The links lead to a GET endpoint <code>php/add-friend.php?uid=</code>. Go ahead, as always and create a file in the php folder called add-friend.php with the following code&hellip;</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;INSERT INTO friend_requests (user_id, friend_id) VALUES (?, ?)&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('ii', $_SESSION['user_id'], $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/home.php?request_sent=true&quot;);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>With a supplied user id in the GET request, we can create a new friend request. The user to whom the request is being made is the friend so their id is stored in <code>friend_id</code>.</p>
<h1 id="acceptdecline-friendrequests">Accept/decline friend requests</h1>
<p>The user who is requested should be able to see who requested them and choose whether to accept or decline. The left sidebar in home.php provides such a facility. With a little padding, we could arrive at something like this:</p>
<pre><code>&lt;h4&gt;friend requests&lt;/h4&gt;
&lt;?php
    $sql = &quot;SELECT * FROM friend_requests WHERE friend_id = {$_SESSION['user_id']}&quot;;
    $result = $conn-&gt;query($sql);

    if ($result-&gt;num_rows &gt; 0) {
        ?&gt;&lt;ul&gt;&lt;?php

        while($f_request = $result-&gt;fetch_assoc()) {
            ?&gt;&lt;li&gt;&lt;?php
                
            $u_sql = &quot;SELECT * FROM users WHERE id = {$f_request['user_id']} LIMIT 1&quot;;
            $u_result = $conn-&gt;query($u_sql);
            $fr_user = $u_result-&gt;fetch_assoc();
            
            ?&gt;&lt;a href=&quot;profile.php?username=&lt;?php echo $fr_user['username']; ?&gt;&quot;&gt;
                &lt;?php echo $fr_user['username']; ?&gt;
            &lt;/a&gt; 
                
            &lt;a class=&quot;text-success&quot; href=&quot;php/accept-request.php?uid=&lt;?php echo $fr_user['id']; ?&gt;&quot;&gt;
                [accept]
            &lt;/a&gt; 
                
            &lt;a class=&quot;text-danger&quot; href=&quot;php/remove-request.php?uid=&lt;?php echo $fr_user['id']; ?&gt;&quot;&gt;
                [decline]
            &lt;/a&gt;

            &lt;/li&gt;&lt;?php
        }

        ?&gt;&lt;/ul&gt;&lt;?php
    } else {
        ?&gt;&lt;p class=&quot;text-center&quot;&gt;No friend requests!&lt;/p&gt;&lt;?php
    }
?&gt;
</code></pre>
<p>In the snippet above, there are two sets of queries. The first pulls out all the friend requests to the current user. The second fetches data (of the requesting user) for each friend request.</p>
<p>There are two links beside each user&rsquo;s username. One to accept and the other to decline. They both lead to different end points. The former to <code>php/accept-request.php?uid=</code> and the latter to <code>php/remove-request.php?uid=</code>.</p>
<p>Remove request:</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;DELETE FROM friend_requests WHERE user_id = ?&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('i', $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/profile.php?username=&quot; . $_SESSION['user_username']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Accept request:</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    // add users to friends table
    $statement = $conn-&gt;prepare(&quot;INSERT INTO friends (user_id, friend_id) VALUES (?, ?), (?, ?)&quot;);
    $statement-&gt;bind_param('iiii', $_SESSION['user_id'], $_GET['uid'], $_GET['uid'], $_SESSION['user_id']);
    // remove friend request
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/php/remove-request.php?uid=&quot; . $_GET['uid']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Friendship is two-sided. I am your and you are my friend. As such, in accept-request.php we insert two records. In one, the current user is the friend and in the other the requesting user is the friend. While it seems like unnecessary duplication, it proves easier to manage. Also notice we use remove-request.php in accept-request.php to delete a friend request once two users have been added as friends.</p>
<h1 id="unfriend-user">Unfriend user</h1>
<p>Unfriending is as simple as removing the records in the friends table that connects two users.</p>
<pre><code>&lt;?php
    require_once &quot;../functions.php&quot;;
    db_connect();
    $sql = &quot;DELETE FROM friends WHERE (user_id = ? AND friend_id = ?) OR (user_id = ? AND friend_id = ?)&quot;;
    $statement = $conn-&gt;prepare($sql);
    $statement-&gt;bind_param('iiii', $_GET['uid'], $_SESSION['user_id'], $_SESSION['user_id'], $_GET['uid']);
    if ($statement-&gt;execute()) {
        redirect_to(&quot;/profile.php?username=&quot; . $_SESSION['user_username']);
    } else {
        echo &quot;Error: &quot; . $conn-&gt;error;
    }
</code></pre>
<p>Viola! We&rsquo;ve built friend relationships into FaceClone!</p>
<p>Again, we&rsquo;re not exploiting the relationships we just created, to keep things simple. But it&rsquo;s pretty straightforward to do so. For example, instead of displaying all FaceClone posts on a user&rsquo;s feed, we could display only posts from their friends. We could also make some of a user&rsquo;s profile information only available to their friends. If we had a chat feature, we could allow only friends chat with each other. As a social network grows, this would make more sense. So if you&rsquo;re working on your social network app after this series (I totally encourage it), keep in mind what the relationships you create would imply.</p>
<p><em>At this point, I must say we are done; at least at the most basic level. So congrats for following through!!! Building a social networking app, especially one like Facebook, is a never-ending journey. There&rsquo;s always something to add to make it easier, faster and/or better to use.</em></p>
<p>We&rsquo;ll be deploying the FaceClone web app online for anyone to use in the next and last part of this series. Be sure to read it!</p>
<p><strong>The final code for this part is contained in my <a href="https://github.com/nicholaskajoh/faceclone">FaceClone repo</a>. Visit the link and click on the part-6 folder to see progress made so far.</strong></p>
<p>Next: <a href="/facebook-clone-7">Build a Facebook clone from scratch with PHP — Part 7</a>.</p>
<p>Previous: <a href="/facebook-clone-5">Build a Facebook clone from scratch with PHP — Part 5</a>.</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2023-03-14</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://alphacoder.xyz/responsive-grid-system/">
			Next<br>A responsive grid system with few lines of CSS
                </a>
                
                
                
                <a class="older-posts" href="https://alphacoder.xyz/facebook-clone-5/">
			Previous<br>Build a Facebook clone from scratch with PHP — Part 5
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                
<div id="disqus_thread"></div>
<script>
    

    var disqus_config = function () {
        
        this.page.url = 'https:\/\/alphacoder.xyz\/facebook-clone-6\/';  
        
        
        this.page.identifier = 'https:\/\/alphacoder.xyz\/facebook-clone-6\/'; 
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://alphacoderxyz.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow"> comments powered by Disqus.  </a> </noscript>











            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">&copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
