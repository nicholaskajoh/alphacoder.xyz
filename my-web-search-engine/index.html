<!DOCTYPE html>
<html><head>
<title>I built my own web search engine — here’s how</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">












<script defer data-domain="alphacoder.xyz" src="https://analytics.terna.io/js/plausible.js"></script>


<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://alphacoder.xyz/images/alpha-coder-logo-v1-small.png">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/journal.min.e3bbe8a4e9def42361d46a08558b2ceeb666c944d881cbcfa75a3435be6afa74.css" integrity="sha256-47vopOne9CNh1GoIVYss7rZmyUTYgcvPp1o0Nb5q&#43;nQ=" media="screen">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/dark-mode.min.16749f4d04ce998e04ecf1c45f01d051b413e9693378f8834e15973538e1d735.css" integrity="sha256-FnSfTQTOmY4E7PHEXwHQUbQT6WkzePiDThWXNTjh1zU=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons|Exo+2");
</script>






  <script src="/js/toc.js"></script>







<script src="https://cdn.jsdelivr.net/npm/vue-disqus@3/dist/vue-disqus.js"></script>








</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://alphacoder.xyz/">
    
        <div class="nav-title">
            Alpha Coder
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/blog/">
                Blog
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://codereviewclub.com">
                Code Review Club
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://www.youtube.com/channel/UC1vg_0J9BGfahmc7flbiwJw">
                Videos
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://tinyletter.com/nicholaskajoh">
                Newsletter
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://twitter.com/AlphaCoderXYZ">
    Twitter
</a>
<br>

<a href="mailto:support@alphacoder.xyz">
    Email
</a>
<br>

<a href="/blog/index.xml">
    RSS
</a>
<br>


        &copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#about-my-search-engine-devsearch" onclick="onNavClick(`#about-my-search-engine-devsearch-nav`)" id="about-my-search-engine-devsearch-nav">
									About my search engine, devsearch
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#stack" onclick="onNavClick(`#stack-nav`)" id="stack-nav">
									Stack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#crawling-web-pages-with-scrapy" onclick="onNavClick(`#crawling-web-pages-with-scrapy-nav`)" id="crawling-web-pages-with-scrapy-nav">
									Crawling web pages with Scrapy
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#indexing" onclick="onNavClick(`#indexing-nav`)" id="indexing-nav">
									Indexing
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tfidf-and-pagerank" onclick="onNavClick(`#tfidf-and-pagerank-nav`)" id="tfidf-and-pagerank-nav">
									TFIDF and PageRank
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#searching-and-autocomplete" onclick="onNavClick(`#searching-and-autocomplete-nav`)" id="searching-and-autocomplete-nav">
									Searching and autocomplete
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#deploying-the-search-engine" onclick="onNavClick(`#deploying-the-search-engine-nav`)" id="deploying-the-search-engine-nav">
									Deploying the search engine
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/blog/">
                    Blog
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://codereviewclub.com">
                    Code Review Club
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://www.youtube.com/channel/UC1vg_0J9BGfahmc7flbiwJw">
                    Videos
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://tinyletter.com/nicholaskajoh">
                    Newsletter
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#about-my-search-engine-devsearch" onclick="onNavClick(`#about-my-search-engine-devsearch-nav`)" id="about-my-search-engine-devsearch-nav">
									About my search engine, devsearch
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#stack" onclick="onNavClick(`#stack-nav`)" id="stack-nav">
									Stack
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#crawling-web-pages-with-scrapy" onclick="onNavClick(`#crawling-web-pages-with-scrapy-nav`)" id="crawling-web-pages-with-scrapy-nav">
									Crawling web pages with Scrapy
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#indexing" onclick="onNavClick(`#indexing-nav`)" id="indexing-nav">
									Indexing
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tfidf-and-pagerank" onclick="onNavClick(`#tfidf-and-pagerank-nav`)" id="tfidf-and-pagerank-nav">
									TFIDF and PageRank
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#searching-and-autocomplete" onclick="onNavClick(`#searching-and-autocomplete-nav`)" id="searching-and-autocomplete-nav">
									Searching and autocomplete
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#deploying-the-search-engine" onclick="onNavClick(`#deploying-the-search-engine-nav`)" id="deploying-the-search-engine-nav">
									Deploying the search engine
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://alphacoder.xyz/">
            Alpha Coder
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://alphacoder.xyz/">
        <div class="single-column-header-title">Alpha Coder</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title" v-pre>
                    I built my own web search engine — here’s how
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2018-07-26
                        </time>
                        

                        

                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>I recently finished building a web search engine. Detailed in this article is how I made it. Enjoy!</p>
<h2 id="about-my-search-engine-devsearch">About my search engine, devsearch</h2>
<p>It was a toy project. The goal was to learn how search engines work by building one, so I wanted it as minimal as possible.</p>
<p>The first step was to narrow my search engine to focus on content in a particular area and a specific format. The web is a very big place. It would take tons of servers to crawl a meaningful portion of the web in good time. I didn’t have the time or the servers. I decided to focus on tech/software development content (hence the name <em>devsearch</em>) and to deal only with textual data.</p>
<p>The next step was to decide on the features to implement. The core functionalities of a search engine are crawling, indexing and searching. But there are a ton of other features that make the search engines we use today so good. Features like autocomplete, auto-correct, <a href="https://en.wikipedia.org/wiki/Stemming">stemming</a>, semantic analysis, contextual search (search history, location, season etc), featured snippets, spam detection, knowledge graph etc.</p>
<p>The features I chose to build were:</p>
<ul>
<li>Crawling</li>
<li>Indexing</li>
<li>Searching (sorting results using TFIDF and PageRank)</li>
<li>Autocomplete</li>
</ul>
<h2 id="stack">Stack</h2>
<p>Python was my language of choice. I also used some HTML, CSS and JavaScript. My stack:</p>
<ul>
<li>Flask (micro framework for Python)</li>
<li>Scrapy (crawling framework for Python)</li>
<li>LXML (for processing XML and HTML in Python)</li>
<li>MongoEngine (object document mapper for MongoDB)</li>
<li>Bootstrap 4 (CSS library for UI components)</li>
</ul>
<h2 id="crawling-web-pages-with-scrapy">Crawling web pages with Scrapy</h2>
<p><a href="https://scrapy.org/">Scrapy</a> is a free and open source web crawling framework. With Scrapy, you can create <a href="https://en.wikipedia.org/wiki/Web_crawler">a <em>spider</em></a>, give it a bunch of urls to crawl and tell it what to do with the pages it fetches. You can even tell the spider to crawl the links it finds on the pages it crawls, allowing it to discover new pages.</p>
<p>I took a very lazy approach to parsing the scrapped pages. I used LXML to extract only the text from the HTML response. Say there’s a HTML page like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">title</span>&gt;How Google Search Works&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;Crawling and indexing&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;As we speak, Google is using web crawlers to organize information from webpages and other publicly available content in the Search index.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;Search algorithms&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;Google ranking systems sort through hundreds of billions of webpages in the Search index to give you useful and relevant results in a fraction of a second.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h1</span>&gt;Useful responses&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;With more content and in a wider variety on the Internet than ever before, Google makes sure to offer you search results in a range of rich formats to help you find the information you’re looking for quickly.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>The output would be:</p>
<pre tabindex="0"><code>How Google Search Works Crawling and indexing As we speak, Google is using web crawlers to organize information from webpages and other publicly available content in the Search index. Search algorithms Google ranking systems sort through hundreds of billions of webpages in the Search index to give you useful and relevant results in a fraction of a second. Useful responses With more content and in a wider variety on the Internet than ever before, Google makes sure to offer you search results in a range of rich formats to help you find the information you’re looking for quickly.
</code></pre><p><em>NB: You lose a lot of important data by doing this but it simplifies things a lot</em> 😊</p>
<p>I also extract all the links in each page (necessary for PageRank).</p>
<pre tabindex="0"><code>Page (How Google Search Works):
    url: https://example.com/google-search
    content: How Google Search Works
        links:
            - Link (Google Search)
            - Link (Search Engines Wiki)
</code></pre><p>There’s a list of allowed domains in the configs (<code>SPIDER_ALLOWED_DOMAINS</code>) which helps to fence the spider. It only crawls pages from the websites in that list.</p>
<p>The spider crawls periodically via a cronjob which runs the custom flask command <code>flask crawl</code>. A <code>--recrawl</code> option can be added to the command to tell the spider whether to crawl new pages or crawl pages it has crawled before in order to update them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ flask crawl --recrawl True
</span></span></code></pre></div><p>A list of urls to crawl (called Crawl List) is maintained in the DB. There needs to be at least one url in the list for the spider to start crawling. As it crawls, it updates the list with new urls and marks the ones it has crawled.</p>
<h2 id="indexing">Indexing</h2>
<p>Indexes help us find things quicker e.g the Table of Contents or Glossary in a book. If we wanted to index a website’s SQL DB, we could create an index table similar to this:</p>
<pre tabindex="0"><code>id title   description    keywords       page
------------------------------------------------
1  G.O.A.T Greatest of... messi, ronaldo /p/goat
</code></pre><p>This is a <a href="https://en.wikipedia.org/wiki/Search_engine_indexing#The_forward_index"><em>forward index</em></a>. It’s very similar to a Table of Contents (which usually has chapter titles, descriptions and page numbers). Instead of writing expensive and complex queries, you can simply lookup the index table and return matching records. However, as the records in the index increase, lookup becomes slower and slower.</p>
<p>There is another type of index which makes searching much faster. It’s the <a href="https://en.wikipedia.org/wiki/Inverted_index"><em>inverted index</em></a>. This is the opposite of the forward index. Instead of having a list of pages and the keywords they contain, we have a list of keywords and the pages they are contained in. This is quite similar to a glossary.</p>
<pre tabindex="0"><code>id word     pages
--------------------------------------------------------
1  greatest /p/goat /u/messi /u/ronaldo /t/football
2  of       /p/goat
3  all      /p/goat /home
4  time     /p/goat /fixtures
</code></pre><p>The trade-off with the inverted index is <em>higher disk comsumption for faster lookup speed</em>. I used an inverted index for <em>devsearch</em>.</p>
<h2 id="tfidf-and-pagerank">TFIDF and PageRank</h2>
<p>Modern search engines consider many factors when ranking search results. Common factors include TFIDF, PageRank, words position, freshness, page loading speed, CTR and mobile-friendliness.</p>
<p>Google says they consider <a href="https://backlinko.com/google-ranking-factors">over 200 factors</a>. Each factor has a weight that signifies its importance in the ranking process. Google keeps all this information secret to prevent people (AKA black hat SEOs) from gaming the system. They also <a href="https://moz.com/google-algorithm-change">change things pretty frequently</a> in order to improve search results.</p>
<p>I chose TFIDF and PageRank for my search engine. TFIDF stands for <em>term frequency–inverse document frequency</em>. It is a numerical statistic that is intended to reflect how important a word is to a document in a collection. The idea is that if a word appears frequently in a document, then the document is probably about that word. In this article for instance, the words ‘search’ and ‘engine’ appear frequently. So we can assume it at least has something to do with search engines, and that if someone were to search for ‘search engine’ this article would be more relevant to them than another article that mentions it once or twice. There are words that usually appear frequently in documents though e.g <a href="https://en.wikipedia.org/wiki/Stop_words">stop words</a> like ‘a’, ‘and’, ‘the’ etc. We can offset these words and give more weight to words that occur less frequently in the whole collection but more frequently in a given document. The formula for TFIDF can be found in <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">this article on Wikipedia</a>.</p>
<p>Developed by Larry Page and Sergey Brin, <a href="https://en.wikipedia.org/wiki/PageRank">PageRank</a> is the most notable algorithm used in Google Search. PageRank works by counting the number [and quality] of links to a page to determine a rough estimate of how important the website is. The underlying assumption is that more important websites are likely to receive more links from other websites. I used <a href="https://en.wikipedia.org/wiki/PageRank#Simplified_algorithm">the simplified version of the algorithm</a> for <em>devsearch</em>. All pages start with an initial PageRank of 1 / N (where N = total number of pages in DB) and then “<a href="https://www.woorank.com/en/edu/seo-guides/link-juice">link juice</a>” begins to flow until all pages are ranked.</p>
<p>I combined the TFIDF and PageRank values to produce a score which is used to rank results.</p>
<h2 id="searching-and-autocomplete">Searching and autocomplete</h2>
<p>When a user types in a query into <em>devsearch</em>, the query is divided into a list of words. The index collection (MongoDB) is filtered for records that have any of those words. Each index record has a score which is precomputed using the formula:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>score <span style="color:#f92672">=</span> (tfidf <span style="color:#f92672">/</span> max(tfidf) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">+</span> (pagerank <span style="color:#f92672">/</span> max(pagerank) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.3</span>)
</span></span></code></pre></div><p>TFIDF represents 70% of the score and PageRank represents the remaining 30.</p>
<p>An aggregate score is computed for each distinct page. So if the search query is <em>‘rick and morty’</em>, a page that contains all the words would have an aggregate score of: <code>total_score = score('rick') + score('and') + score('morty')</code>.</p>
<p>The records are sorted in descending order of <code>total_score</code> and then paginated.</p>
<p>Autocomplete for the search box is very very basic. I didn’t want to get AJAX involved, so I just queried the DB for a list of the top 200 searches on the search view and passed them to a JavaScript function which uses sub-string matching to determine whether a query should be shown or not when a user is typing their query. 😉</p>
<h2 id="deploying-the-search-engine">Deploying the search engine</h2>
<p>I used Docker (and Docker Compose) to containerize <em>devsearch</em> and run it on a DigitalOcean Debian machine. The MongoDB server is also containerized. The production Docker Compose file uses Nginx as a reverse proxy for the Gunicorn server running the Flask app. Nginx also serves the static files.</p>
<hr>
<p>The search results from <em>devsearch</em> are abysmal (good thing I wasn’t hoping to build the next Google Search). However, I learnt a ton about search engines and search algorithms, and have already started exploring the areas most interesting to me. Most important, I understand a little better how search engines work! 🙌</p>
<p>You can find the source code for <em>devsearch</em> on my GitHub: <a href="https://github.com/nicholaskajoh/devsearch"><strong>nicholaskajoh/devsearch</strong></a>.</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2018-07-26</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://alphacoder.xyz/dockerizing-django/">
			Next<br>Dockerizing Django in development and production
                </a>
                
                
                
                <a class="older-posts" href="https://alphacoder.xyz/multiple-apps-one-server-with-docker-and-traefik/">
			Previous<br>How to run multiple apps on one server using Docker and Traefik
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                
<div id="disqus_thread"></div>
<script>
    

    var disqus_config = function () {
        
        this.page.url = 'https:\/\/alphacoder.xyz\/my-web-search-engine\/';  
        
        
        this.page.identifier = 'https:\/\/alphacoder.xyz\/my-web-search-engine\/'; 
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://alphacoderxyz.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow"> comments powered by Disqus.  </a> </noscript>











            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">&copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
