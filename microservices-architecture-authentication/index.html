<!DOCTYPE html>
<html><head>
<title>Authentication strategies in microservices architecture</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-82728104-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://alphacoder.xyz/images/alpha-coder-logo-v1-small.png">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/journal.min.e3bbe8a4e9def42361d46a08558b2ceeb666c944d881cbcfa75a3435be6afa74.css" integrity="sha256-47vopOne9CNh1GoIVYss7rZmyUTYgcvPp1o0Nb5q&#43;nQ=" media="screen">



<link rel="stylesheet" href="https://alphacoder.xyz/scss/dark-mode.min.16749f4d04ce998e04ecf1c45f01d051b413e9693378f8834e15973538e1d735.css" integrity="sha256-FnSfTQTOmY4E7PHEXwHQUbQT6WkzePiDThWXNTjh1zU=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons|Exo+2");
</script>






  <script src="/js/toc.js"></script>







<script src="https://cdn.jsdelivr.net/npm/vue-disqus@3/dist/vue-disqus.js"></script>








</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://alphacoder.xyz/">
    
        <div class="nav-title">
            Alpha Coder
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/blog/">
                Blog
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://codereviewclub.com">
                Code Review Club
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://www.youtube.com/channel/UC1vg_0J9BGfahmc7flbiwJw">
                Videos
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://tinyletter.com/nicholaskajoh">
                Newsletter
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
<a href="https://twitter.com/AlphaCoderXYZ">
    Twitter
</a>
<br>

<a href="mailto:support@alphacoder.xyz">
    Email
</a>
<br>

<a href="/blog/index.xml">
    RSS
</a>
<br>


        &copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#auth-service" onclick="onNavClick(`#auth-service-nav`)" id="auth-service-nav">
									Auth service
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jwt-verification-per-service" onclick="onNavClick(`#jwt-verification-per-service-nav`)" id="jwt-verification-per-service-nav">
									JWT verification per service
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#token-blacklist-cache" onclick="onNavClick(`#token-blacklist-cache-nav`)" id="token-blacklist-cache-nav">
									Token blacklist cache
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#api-gateway-auth" onclick="onNavClick(`#api-gateway-auth-nav`)" id="api-gateway-auth-nav">
									API gateway auth
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/blog/">
                    Blog
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://codereviewclub.com">
                    Code Review Club
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://www.youtube.com/channel/UC1vg_0J9BGfahmc7flbiwJw">
                    Videos
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://tinyletter.com/nicholaskajoh">
                    Newsletter
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- OUTLINE -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#auth-service" onclick="onNavClick(`#auth-service-nav`)" id="auth-service-nav">
									Auth service
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#jwt-verification-per-service" onclick="onNavClick(`#jwt-verification-per-service-nav`)" id="jwt-verification-per-service-nav">
									JWT verification per service
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#token-blacklist-cache" onclick="onNavClick(`#token-blacklist-cache-nav`)" id="token-blacklist-cache-nav">
									Token blacklist cache
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#api-gateway-auth" onclick="onNavClick(`#api-gateway-auth-nav`)" id="api-gateway-auth-nav">
									API gateway auth
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://alphacoder.xyz/">
            Alpha Coder
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://alphacoder.xyz/">
        <div class="single-column-header-title">Alpha Coder</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title" v-pre>
                    Authentication strategies in microservices architecture
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2019-09-29
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tag/microservices">Microservices</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>When moving from monolith to microservices or considering microservices for a greenfield project, it&rsquo;s important to evaluate the authentication strategies available to you to find the one most suitable for your system, as authentication is an integral part of how most applications are interacted with.</p>
<p>In this article, I outline the most common auth strategies I&rsquo;ve come across working with microservices, describing how they work and identifying their pros and cons.</p>
<h1 id="auth-service">Auth service</h1>
<p>In this strategy, a microservice is created for the purpose of authentication. This service is contacted by downstream services required to authenticate client requests before processing them.</p>
<p><img src="/images/msvc-auth/auth-svc.png" alt=""></p>
<p>Pros:</p>
<ul>
<li>It&rsquo;s easy to implement and reason about, especially when transitioning from a monolith. The auth service is essentially a utility other services reach out to for their authentication needs.</li>
</ul>
<p>Cons:</p>
<ul>
<li>
<p>It introduces a single point of failure. If the auth service is down, the whole application (or most of it) is down.</p>
</li>
<li>
<p>Increased latency. The time taken to make a request to and get a response from the auth service can hurt the average response time of a microservices application negatively.</p>
</li>
</ul>
<h1 id="jwt-verification-per-service">JWT verification per service</h1>
<p>This approach is an extension of the previous strategy and is intended to reduce dependence on the auth service. Authentication primarily involves issuing and verifying tokens. JWT (<a href="https://jwt.io">JSON Web Tokens</a>) can be used to verify tokens without having to hit a database or other persistent storage. This means each service can verify requests on their own. Token issuing is done in the auth service, while verification is handled in every service where it&rsquo;s required. A client library is usually used to share this verification functionality with all the services that need to perform authentication.</p>
<p><img src="/images/msvc-auth/jwt-verifier.png" alt=""></p>
<p>Pros:</p>
<ul>
<li>
<p>There&rsquo;s no single point of failure, auth-wise. The authentication service is only used for issuing tokens. All other services can handle token verification on their own.</p>
</li>
<li>
<p>It&rsquo;s easy to create a client library for token verification which can be shared by all the services that require auth (assuming a single tech stack is used across board).</p>
</li>
</ul>
<p>Cons:</p>
<ul>
<li>
<p>JWT can&rsquo;t be invalidated on-demand. While this is not a problem for some types of applications, it&rsquo;s a deal breaker for others e.g an enterprise app where an admin might want to disable or delete a user or a finance app where a user might want to sign out from one or more devices remotely.</p>
</li>
<li>
<p>Making a change to the verification logic (e.g adding a new permission) requires updating all dependent services. This might be a Herculean task if a large number of services are involved.</p>
</li>
</ul>
<h1 id="token-blacklist-cache">Token blacklist cache</h1>
<p>To compensate for the shortcomings of JWT, a cache can be used to store tokens that need to be invalidated. This means that every service must contact a shared cache to check if a token has been blacklisted after successfully verifying it, before proceeding to execute any auth-protected code.</p>
<p><img src="/images/msvc-auth/token-blacklist-cache.png" alt=""></p>
<p>Pros:</p>
<ul>
<li>JWTs can be invalidated on-demand through blacklisting.</li>
</ul>
<p>Cons:</p>
<ul>
<li>
<p>This strategy is not feasible in a system where each service has its own datastore.</p>
</li>
<li>
<p>If multiple services are allowed to write to the cache, they might erroneously modify token blacklist data, causing problems that might be difficult to detect and fix.</p>
</li>
<li>
<p>The shared cache introduces a single point of failure to the system.</p>
</li>
</ul>
<h1 id="api-gateway-auth">API gateway auth</h1>
<p>Most, if not all, microservices applications use an API gateway. An API gateway is the entry point where client requests go to before being sent to the appropriate API/edge services. The main function of a gateway is routing requests but they can be used for other purposes such as analytics, rate-limiting, data transformation, logging, health monitoring, caching and as you might have already guessed, authentication.</p>
<p><img src="/images/msvc-auth/api-gateway-auth.png" alt=""></p>
<p>Pros:</p>
<ul>
<li>Separation of concerns. Services can communicate freely with each other and do what they need to do as authentication has already been handled downstream by the gateway.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Switching to an API gateway&rsquo;s auth system from an existing application&rsquo;s auth implementation can be difficult and time-consuming.</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2019-09-29</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://alphacoder.xyz/levels-of-abstraction/">
			Next<br>What level of abstraction should I play on?
                </a>
                
                
                
                <a class="older-posts" href="https://alphacoder.xyz/connect-to-host-database-from-docker-container/">
			Previous<br>How to connect to a host&#39;s database from inside a Docker container
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                
<div id="disqus_thread"></div>
<script>
    

    var disqus_config = function () {
        
        this.page.url = 'https:\/\/alphacoder.xyz\/microservices-architecture-authentication\/';  
        
        
        this.page.identifier = 'https:\/\/alphacoder.xyz\/microservices-architecture-authentication\/'; 
    };
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://alphacoderxyz.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow"> comments powered by Disqus.  </a> </noscript>











            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">&copy;
    
    Copyright 2017 to ∞. Nicholas Kajoh. All rights reserved.
    
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
